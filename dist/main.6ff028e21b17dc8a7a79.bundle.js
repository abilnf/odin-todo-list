(()=>{"use strict";function e(e,t,o){return{day:e,month:t,year:o,getDate:()=>`${e.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}.${t.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})}.${o.toLocaleString("en-US",{minimumIntegerDigits:4,useGrouping:!1})}`}}const t=function(){document.querySelector(".project-selected").addEventListener("click",(t=>{r.selectProject(null),e()}));const e=()=>{const e=document.querySelector("#todos");document.querySelectorAll("#todos > *:not(template)").forEach((t=>{e.removeChild(t)}));let t=null;const c=document.querySelector("#todo-card-template"),n=document.querySelector("#todo-date-template");for(let d of r.getTodos()){if(JSON.stringify(t)!==JSON.stringify(d.date)){t=d.date;const o=n.content.firstElementChild.cloneNode(!0);o.textContent=t.getDate(),e.appendChild(o)}const r=c.content.firstElementChild.cloneNode(!0);r.addEventListener("click",(e=>{const t=r.querySelector(".expandable-area");t.classList.contains("expandable-area--hidden")?t.style.maxHeight=t.scrollHeight+"px":t.style.maxHeight=null,t.classList.toggle("expandable-area--hidden")})),r.querySelector(".todo-done-checkox").addEventListener("click",(e=>{e.stopPropagation()})),r.querySelector(".todo-done-checkox").addEventListener("change",(e=>{r.classList.toggle("todo-card--done"),d.done=e.target.checked,o.saveProjects()})),r.querySelector(".todo-name").textContent=d.name,r.querySelector(".todo-description").textContent=d.description,e.appendChild(r)}};return{showNewProjectDialog:()=>{document.querySelector("#new-project-dialog").classList.toggle("dialog--hidden")},showNewTodoDialog:()=>{const e=document.querySelector("#new-todo-project");e.querySelectorAll("option[data-project]").forEach((t=>{e.removeChild(t)})),e.querySelector("option").selected=!0;const t=document.querySelector("#new-todo-project-selector-template");for(let o of r.getProjectNames()){const r=t.content.firstElementChild.cloneNode(!0);r.textContent=o,r.setAttribute("data-project",o),e.appendChild(r)}document.querySelector("#new-todo-dialog").classList.toggle("dialog--hidden")},closeDialogs:()=>{document.querySelectorAll(".dialog-container input, .dialog-container textarea").forEach((e=>e.value="")),document.querySelectorAll(".dialog-container").forEach((e=>e.classList.add("dialog--hidden")))},updateProjects:()=>{const e=document.querySelector("#sidebar");e.querySelectorAll(".project[data-project]").forEach((t=>{e.removeChild(t)}));const o=document.querySelector("#project-template"),c=r.getCurrentProject();for(let n of r.getProjectNames()){const d=o.content.firstElementChild.cloneNode(!0);d.querySelector(".project-name").textContent=n,n===c&&(d.querySelector(".project-selected").checked=!0),d.querySelector(".project-selected").addEventListener("click",(e=>{e.target.checked&&(r.selectProject(n),t.updateTodos())})),e.insertBefore(d,e.querySelector(".divider"))}},updateTodos:e}}(),o={saveProjects:()=>{const e=JSON.stringify(r.getRawProjects());localStorage.projects=e},loadProjects:()=>{const t=localStorage.projects;if(t){const o=JSON.parse(t);for(let t of Object.values(o)){const o=[];for(let r of t.todos)r.date=e(r.date.day,r.date.month,r.date.year),r.done||o.push(r);t.todos=o}return o}return{}}},r=function(t){const o=t;let r=null;return{addProject:e=>!o.hasOwnProperty(e)&&(o[e]=function(e){return{name:e,todos:[]}}(e),!0),getProjectNames:()=>Object.keys(o),selectProject:e=>{r=e},getCurrentProject:()=>r,addTodo:(t,r,c,n,d,l)=>{o[t].todos.push(function(e,t,o){return{name:e,description:t,date:o,done:!1}}(r,c,e(n,d,l)))},getTodos:()=>{let e=(r?o[r].todos:Object.values(o).map((e=>e.todos)).flat(1)).slice();return e.sort(((e,t)=>1e4*e.date.year+100*e.date.month+e.date.day-(1e4*t.date.year+100*t.date.month+t.date.day))),e},getRawProjects:()=>o}}(o.loadProjects());document.querySelectorAll(".close-dialog").forEach((e=>{e.addEventListener("click",t.closeDialogs)})),document.querySelector("#add-todo").addEventListener("click",(e=>{t.showNewTodoDialog()})),document.querySelector("#add-project").addEventListener("click",(e=>{t.showNewProjectDialog()})),document.querySelector("#confirm-new-project").addEventListener("click",(e=>{const c=document.querySelector("#new-project-title").value;c&&r.addProject(c)&&(t.closeDialogs(),t.updateProjects(),o.saveProjects())})),document.querySelector("#confirm-new-todo").addEventListener("click",(e=>{const c=document.querySelector("#new-todo-name").value,n=document.querySelector("#new-todo-date").value,d=document.querySelector("#new-todo-description").value,l=document.querySelector("#new-todo-project").selectedOptions[0].getAttribute("data-project");if(c&&n&&d&&l){const e=new Date,[a,s,i]=n.split("-").map((e=>parseInt(e)));a<e.getFullYear()||a==e.getFullYear()&&s<e.getMonth()+1||a==e.getFullYear()&&s==e.getMonth()+1&&i<e.getDate()||(r.addTodo(l,c,d,i,s,a),t.closeDialogs(),t.updateTodos(),o.saveProjects())}})),t.updateProjects(),t.updateTodos()})();